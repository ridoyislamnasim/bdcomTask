<%- include(`../commonPartial/header.ejs`); %>
<%- include(`../commonPartial/menu.ejs`); %>
<section class="home-section">
  <div class="home-content">

    <div class="manageAddRoom-container">
      <div id="title">
        <h2>Manage Exam Routine</h2>
      </div>
      

      <div class="new-room-container new-room">
        <a href="#" onclick="CreateExamRoutine()" class="newadd">Create Routine</a>
      </div>
      <div id="table">
        <span id="odd_subject_max" style="display: none;">
          <%= odd_subject_max %>
        </span>
        <span id="even_subject_max" style="display: none;">
          <%= even_subject_max %>
        </span>
        <table id="routine-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Slot A</th>
              <th>Slot B</th>
              <th>Slot C</th>
              <th>Slot D</th>
            </tr>
          </thead>

          <tbody id="">

            <!-- create coloum -->
            <!-- "DATE" -->
            <% for(var i=0; i < Routine.length ; i++){%>

            <!-- //if part arry more than one than rowspan work ,bacouse arry start 0 ,on the otherhand rowspan didnot work 0; -->

            <!-- array loop visite -->
            <!-- "Slot" -->


            <tr <% if (i % 2===0) { %> class="odd" <% } else { %> class="even" <% } %>>
              <td>
                <div class="td-conatiner">
                  <div class="td-item-auto-fit">

                  <% const date = new Date(Routine[i].examDate); %>
                  <span><%= date.toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' })   %>
                    <span>-</span>( <%= date.toLocaleDateString(undefined, { weekday: 'long'}) %> )</span>
                </div>
              </div>
              </td>
              <td>
                <!-- check A -->
                <% for (var j=0; j < Routine[i].slotInfo.length ; j++) { %>
                <% if (Routine[i].slotInfo[j].slotName == 'A') { %>
                <div class="td-conatiner">
                  <% for( let index = 0; index < Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                  <% for( let index = 0; index < Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                </div>
                <% } %>
                <% } %>
              </td>
              <td>
                <!-- check B -->
                <% for (var j=0; j < Routine[i].slotInfo.length ; j++) { %>
                <% if (Routine[i].slotInfo[j].slotName == 'B') { %>
                <div class="td-conatiner">
                  <% for( let index = 0; index < Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">

                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseName %></span>

                  </div>
                  <% } %>
                  <% for( let index = 0; index < Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                </div>
                <% } %>
                <% } %>
              </td>
              <td>
                <!-- check C -->
                <% for (var j=0; j < Routine[i].slotInfo.length ; j++) { %>
                <% if (Routine[i].slotInfo[j].slotName == 'C') { %>
                <div class="td-conatiner">
                  <% for( let index = 0; index < Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                  <% for( let index = 0; index < Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                </div>
                <% } %>
                <% } %>
              </td>
              <td>
                <!-- check D -->
                <% for (var j=0; j < Routine[i].slotInfo.length ; j++) { %>
                <% if (Routine[i].slotInfo[j].slotName == 'D') { %>
                <div class="td-conatiner">
                  <% for( let index = 0; index < Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].oddqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                  <% for( let index = 0; index < Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation.length; index++ ) { %>
                  <div class="td-item-auto-fit">
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseCode %></span>
                    <span><%= Routine[i].slotInfo[j].evenqurstionInfo.subjectInformation[index].courseName %></span>
                  </div>
                  <% } %>
                </div>
                <% } %>
                <% } %>
              </td>
            </tr>


            <!-- array loop visite end -->


            <%} %>
            <!-- create coloum end -->

          </tbody>
        </table>


      </div>
    </div>
  </div>
</section>
<!-- manu open close -->
<%- include(`../commonPartial/manuOpenCloseScript.ejs`); %>
<script>
  $(document).ready(function() {
    $('#routine-table').DataTable({
      "order": [[0, "desc"]], // Sorts the first column in ascending order
      "pagingType": "full_numbers",
      "rowGroup": {
        "dataSrc": 0 // Group rows based on the data in the first column (index 0)
      },
      "language": {
        "paginate": {
          "first": "First",
          "previous": "Previous",
          "next": "Next",
          "last": "Last"
        }
      }
    });
  });
</script>
<script>
  let routine_table = document.getElementById("routine-table");
  console.log("table", routine_table)
  let odd_subject_max = document.getElementById("odd_subject_max");
  let even_subject_max = document.getElementById("even_subject_max");
  // console.log("tablcoloumsmaxe,", typeof (coloumsmax.innerHTML))
  let oddsubject_max = Number(odd_subject_max.innerHTML);
  let evensubject_max = Number(even_subject_max.innerHTML);
  console.log("table ---", odd_subject_max, even_subject_max)
  console.log("table -", oddsubject_max, evensubject_max)
  let j = 1
  if (oddsubject_max == 0) {
    oddsubject_max = 1
  }

  // Function to show a toast message
function showToast(message, isError = false) {
  Toastify({
    text: message,
    duration: 5000,
    backgroundColor: isError ? "#f44336" : "",
  }).showToast();
}


  async function CreateExamRoutine() {
    let response = await fetch("/Administrator/Routine/createRoutine", {
      method: "post",
    });
    let responseData = await response.json();
    // alert("responseData");

    console.log("responseData", responseData);
    console.log("responseData.message", responseData.message);

    if (responseData.message) {
      // errors
      // alert(responseData.message);
      console.log("working go",responseData.message)
      await showToast(responseData.message,responseData.error ); // Show the toast message for 9000 milliseconds (9 seconds)
      setTimeout(() => {
        location.reload();
      }, 2000);
      
    } else {
      // success
      // successToast.showToast();success_massage
      console.log("close");
      await showToast(responseData.success_massage,responseData.error ); // Show the toast message for 9000 milliseconds (9 seconds)


      // reload the page after 1 second
      setTimeout(() => {
        location.reload();
      }, 1000);
    }
  }


</script>